---
import "../styles/global.css";
import { investmentAssets } from '../data/assets';
import { getEntityDetails, getDetailPath } from '../data/entityDetails';

const {
  title = "Listwin Ventures",
  description = "Technology investing, leadership, and philanthropy from Don Listwin."
} = Astro.props;

const entityDetails = getEntityDetails();
const detailBySlug = new Map(entityDetails.map((detail) => [detail.slug, detail]));

const workItems = entityDetails.filter((detail) => detail.slug === 'carbon-robotics');

const investmentSections = investmentAssets
  .map((group) => {
    const items = group.items
      .map((asset) => detailBySlug.get(asset.id))
      .filter((detail) => detail && detail.slug !== 'carbon-robotics');
    return { label: group.label, items };
  })
  .filter((section) => section.items.length > 0);

const exitSlugs = ['openwave', 'joyent', 'isilon', 'plumgrid', 'teradici'];
const exitItems = exitSlugs.map((slug) => detailBySlug.get(slug)).filter(Boolean);
if (exitItems.length) {
  investmentSections.push({ label: 'Exits', items: exitItems });
}

const communityItems = entityDetails.filter((detail) => detail.categories.includes('philanthropy'));

const prettify = (name: string) => name.replace(/\s+(logo|crest|lockup)$/i, '');

const workHighlights = [
  {
    label: 'Carbon Robotics',
    description: 'AI-driven laser weeding and farm autonomy.',
    href: getDetailPath('carbon-robotics'),
  },
  {
    label: 'BelizeKids.org',
    description: 'STEM, clinics, and conservation programs across Belize.',
    href: '/belizekids',
  },
];

const storyLinks = [
  { label: 'Interviews', href: '/oral-history' },
  { label: 'My Story', href: '/#my-story' },
];

const communityLinks = communityItems.map((item) => ({
  label: item.name,
  href: getDetailPath(item.slug),
}));

const navItems = [
  { label: 'Home', href: '/' },
  { label: 'Work', type: 'work' },
  { label: 'Investments', type: 'investments' },
  { label: 'Community', type: 'community' },
  { label: 'Stories', type: 'stories' },
];
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <link rel="stylesheet" href="/assets/css/skin.css" />
    <link rel="stylesheet" href="/assets/css/theme.css" />
  </head>
  <body class="min-h-screen bg-fog text-ink">
    <div class="flex min-h-screen flex-col">
      <header class="sticky top-0 z-40 border-b border-white/60 bg-white/80 backdrop-blur">
        <div class="mx-auto flex max-w-6xl flex-wrap items-center justify-between gap-4 px-4 py-4 sm:px-6 lg:px-8">
            <a href="/" class="flex items-center gap-3 text-xl font-semibold tracking-tight text-ink">
              <img src="https://res.cloudinary.com/dhqpqfw6w/image/upload/v1762622395/LV_logo-02-300x120_gobztf.webp" alt="Listwin Ventures" class="h-10 w-auto" loading="lazy" />
              <span class="sr-only">Listwin Ventures</span>
            </a>
          <button
            type="button"
            class="inline-flex items-center rounded-full border border-slate-200 px-4 py-2 text-sm font-semibold text-ink transition hover:border-brand hover:text-brand focus:outline-none focus-visible:ring-2 focus-visible:ring-brand sm:hidden"
            data-nav-toggle
            aria-expanded="false"
            aria-controls="primary-navigation"
          >
            Menu
          </button>
          <nav
            id="primary-navigation"
            data-nav-menu
            class="hidden w-full flex-col gap-4 rounded-3xl bg-white/95 p-5 text-sm text-ink shadow-panel ring-1 ring-ink/5 sm:flex sm:w-auto sm:flex-row sm:items-center sm:gap-6 sm:rounded-none sm:bg-transparent sm:p-0 sm:text-ink sm:shadow-none sm:ring-0"
          >
            <div class="flex flex-col gap-4 sm:hidden">
              <a class="w-full rounded-2xl border border-ink/10 bg-fog/40 px-4 py-3 text-base font-semibold text-ink/80" href="/">
                Home
              </a>
              {[
                { type: 'work', label: 'Work' },
                { type: 'investments', label: 'Investments' },
                { type: 'community', label: 'Community' },
                { type: 'stories', label: 'Stories' },
              ].map((menu) => (
                <details class="rounded-2xl border border-ink/10 bg-white px-4 py-2" data-dropdown>
                  <summary class="flex list-none cursor-pointer items-center justify-between text-base font-semibold text-ink/80">
                    {menu.label}
                    <span aria-hidden="true" class="text-xs text-ink/50 transition-transform duration-200" data-dropdown-caret>
                      &#9662;
                    </span>
                  </summary>
                  <div class="mt-3 space-y-2 text-sm text-ink/80">
                    {menu.type === 'work' &&
                      workHighlights.map((highlight) => (
                        <a class="block rounded-xl border border-ink/5 bg-fog/40 px-3 py-2" href={highlight.href}>
                          <span class="block text-sm font-semibold text-ink">{highlight.label}</span>
                          <span class="block text-xs text-ink/60">{highlight.description}</span>
                        </a>
                      ))}
                    {menu.type === 'investments' &&
                      investmentSections.map((section) => (
                        <div class="rounded-xl border border-ink/5 bg-fog/20 p-3">
                          <p class="text-xs font-semibold uppercase tracking-[0.3em] text-ink/60">{section.label}</p>
                          <div class="mt-2 space-y-1">
                            {section.items.map((sectionItem) => (
                              <a class="block rounded-lg px-3 py-1 hover:bg-brand/10 hover:text-brand" href={getDetailPath(sectionItem.slug)}>
                                {prettify(sectionItem.name)}
                              </a>
                            ))}
                          </div>
                        </div>
                      ))}
                    {menu.type === 'community' &&
                      communityLinks.map((link) => (
                        <a class="block rounded-xl border border-ink/5 bg-fog/20 px-3 py-2 hover:border-brand hover:bg-brand/10 hover:text-brand" href={link.href}>
                          {prettify(link.label)}
                        </a>
                      ))}
                    {menu.type === 'stories' &&
                      storyLinks.map((link) => (
                        <a class="block rounded-xl border border-ink/5 bg-fog/20 px-3 py-2 hover:border-brand hover:bg-brand/10 hover:text-brand" href={link.href}>
                          {link.label}
                        </a>
                      ))}
                  </div>
                </details>
              ))}
              <a
                class="inline-flex items-center justify-center rounded-full border border-ink/20 px-4 py-3 text-base font-semibold text-ink transition hover:border-brand hover:text-brand"
                href="/contact"
              >
                Contact
              </a>
              <p class="border-t border-ink/10 pt-4 text-xs uppercase tracking-[0.3em] text-ink/50">
                Built with founders, operators, and community partners.
              </p>
            </div>
            <div class="hidden w-full flex-col gap-4 text-sm sm:flex sm:w-auto sm:flex-row sm:items-center sm:gap-6">
              {navItems.map((item, index) => {
                if (!item.type) {
                  return (
                    <a class="font-medium text-ink/80 transition hover:text-brand" href={item.href} key={item.label}>
                      {item.label}
                    </a>
                  );
                }

              if (item.type === 'investments') {
                return (
                  <details class="relative group" key={item.label} data-dropdown>
                    <summary class="flex list-none cursor-pointer items-center gap-2 font-medium text-ink/80 transition hover:text-brand">
                      {item.label}
                      <span aria-hidden="true" class="text-xs text-ink/50 transition-transform duration-200" data-dropdown-caret>
                        &#9662;
                      </span>
                    </summary>
                    <div class="mt-2 hidden flex-col gap-4 rounded-3xl bg-white p-5 text-sm text-ink shadow-panel ring-1 ring-slate-200 group-open:flex sm:absolute sm:right-0 sm:mt-3 sm:min-w-[260px] sm:w-[720px] sm:flex-row sm:flex-wrap sm:gap-5 sm:p-6">
                      {investmentSections.map((section) => (
                        <div class="w-full space-y-3 rounded-2xl border border-ink/5 bg-fog/30 p-4 sm:w-[calc(50%-10px)]" key={section.label}>
                          <p class="text-xs font-semibold uppercase tracking-[0.3em] text-ink/60">{section.label}</p>
                          <div class="space-y-1.5">
                            {section.items.map((sectionItem) => (
                              <a
                                class="block rounded-xl px-3 py-1.5 text-ink/80 transition hover:bg-brand/10 hover:text-brand"
                                href={getDetailPath(sectionItem.slug)}
                              >
                                {prettify(sectionItem.name)}
                              </a>
                            ))}
                          </div>
                        </div>
                      ))}
                    </div>
                  </details>
                );
              }

              if (item.type === 'work') {
                return (
                  <details class="relative group" key={item.label} data-dropdown>
                    <summary class="flex list-none cursor-pointer items-center gap-2 font-medium text-ink/80 transition hover:text-brand">
                      {item.label}
                      <span aria-hidden="true" class="text-xs text-ink/50 transition-transform duration-200" data-dropdown-caret>
                        &#9662;
                      </span>
                    </summary>
                    <div class="mt-2 hidden flex-col gap-4 rounded-3xl bg-white p-5 text-sm text-ink shadow-panel ring-1 ring-slate-200 group-open:flex sm:absolute sm:right-0 sm:mt-3 sm:min-w-[320px]">
                      {workHighlights.map((highlight) => (
                        <a
                          key={highlight.label}
                          class="block space-y-1 rounded-2xl border border-ink/5 bg-fog/40 px-4 py-3 text-left transition hover:border-brand hover:bg-brand/10 hover:text-brand"
                          href={highlight.href}
                        >
                          <span class="block text-sm font-semibold text-ink">{highlight.label}</span>
                          <span class="block text-xs text-ink/60">{highlight.description}</span>
                        </a>
                      ))}
                    </div>
                  </details>
                );
              }

              if (item.type === 'community') {
                return (
                  <details class="relative group" key={item.label} data-dropdown>
                    <summary class="flex list-none cursor-pointer items-center gap-2 font-medium text-ink/80 transition hover:text-brand">
                      {item.label}
                      <span aria-hidden="true" class="text-xs text-ink/50 transition-transform duration-200" data-dropdown-caret>
                        &#9662;
                      </span>
                    </summary>
                    <div class="mt-2 hidden flex-col gap-2 rounded-3xl bg-white p-4 text-sm text-ink shadow-panel ring-1 ring-slate-200 group-open:flex sm:absolute sm:right-0 sm:mt-3 sm:w-[320px]">
                      {communityLinks.map((link) => (
                        <a
                          key={link.label}
                          class="block rounded-2xl border border-ink/5 bg-fog/40 px-4 py-2 transition hover:border-brand hover:bg-brand/10 hover:text-brand"
                          href={link.href}
                        >
                          {prettify(link.label)}
                        </a>
                      ))}
                    </div>
                  </details>
                );
              }

              if (item.type === 'stories') {
                return (
                  <details class="relative group" key={item.label} data-dropdown>
                    <summary class="flex list-none cursor-pointer items-center gap-2 font-medium text-ink/80 transition hover:text-brand">
                      {item.label}
                      <span aria-hidden="true" class="text-xs text-ink/50 transition-transform duration-200" data-dropdown-caret>
                        &#9662;
                      </span>
                    </summary>
                    <div class="mt-2 hidden flex-col gap-2 rounded-3xl bg-white p-4 text-sm text-ink shadow-panel ring-1 ring-slate-200 group-open:flex sm:absolute sm:right-0 sm:mt-3 sm:w-[260px]">
                      {storyLinks.map((link) => (
                        <a
                          key={link.label}
                          class="block rounded-2xl border border-ink/5 bg-fog/40 px-4 py-2 transition hover:border-brand hover:bg-brand/10 hover:text-brand"
                          href={link.href}
                        >
                          {link.label}
                        </a>
                      ))}
                    </div>
                  </details>
                );
              }

                return null;
              })}
              <a
                class="inline-flex items-center justify-center rounded-full border border-ink/20 px-4 py-2 text-sm font-semibold text-ink transition hover:border-brand hover:text-brand sm:ml-4"
                href="/contact"
              >
                Contact
              </a>
            </div>
          </nav>
        </div>
      </header>
      <main class="flex-1">
        <div class="mx-auto w-full max-w-6xl space-y-10 px-4 py-10 sm:px-6 lg:px-8">
          <slot />
        </div>
      </main>
      <footer class="border-t border-white/60 bg-white/80">
        <div class="mx-auto flex max-w-6xl flex-col gap-4 px-4 py-6 text-sm text-ink/70 sm:flex-row sm:items-center sm:justify-between sm:px-6 lg:px-8">
          <div class="flex items-center gap-3">
            <img
              src="https://res.cloudinary.com/dhqpqfw6w/image/upload/v1762622395/LV_logo-02-300x120_gobztf.webp"
              alt="Listwin Ventures"
              class="h-8 w-auto"
              loading="lazy"
            />
            <span>&copy; {new Date().getFullYear()} Listwin Ventures. All rights reserved.</span>
          </div>
          <div class="flex flex-wrap gap-6">
            <a class="hover:text-brand" href="/privacy-policy">Privacy</a>
            <a class="hover:text-brand" href="/cookie-policy">Cookies</a>
          </div>
        </div>
      </footer>
    </div>
    <script is:inline>
      const toggle = document.querySelector("[data-nav-toggle]");
      const menu = document.querySelector("[data-nav-menu]");
      if (toggle && menu) {
        toggle.addEventListener("click", () => {
          const isOpen = menu.classList.toggle("hidden");
          toggle.setAttribute("aria-expanded", (!isOpen).toString());
        });
        if (window.matchMedia("(min-width: 640px)").matches) {
          menu.classList.remove("hidden");
          toggle.setAttribute("aria-expanded", "true");
        }
        window.addEventListener("resize", () => {
          if (window.matchMedia("(min-width: 640px)").matches) {
            menu.classList.remove("hidden");
            toggle.setAttribute("aria-expanded", "true");
          } else {
            menu.classList.add("hidden");
            toggle.setAttribute("aria-expanded", "false");
          }
        });
      }

      const revealElements = document.querySelectorAll("[data-reveal]");
      const isMobile = window.matchMedia("(max-width: 640px)").matches;
      if (isMobile || !("IntersectionObserver" in window)) {
        revealElements.forEach((el) => el.classList.add("is-visible"));
      } else if (revealElements.length) {
        const observer = new IntersectionObserver(
          (entries, obs) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                entry.target.classList.add("is-visible");
                obs.unobserve(entry.target);
              }
            });
          },
          { threshold: 0.15, rootMargin: "0px 0px -10% 0px" },
        );
        revealElements.forEach((el) => observer.observe(el));
      }

      const typingEl = document.getElementById("hero-typing");
      const typingPhrases = ["Technology investor", "CEO", "Philanthropist"];
      const prefersStaticTyping = window.matchMedia("(max-width: 640px)").matches;
      if (typingEl && typingPhrases.length) {
        if (prefersStaticTyping) {
          typingEl.textContent = typingPhrases.join(" â€¢ ");
        } else {
          let phraseIndex = 0;
          let charIndex = 0;
          let deleting = false;
          const typeSpeed = 90;
          const eraseSpeed = 60;
        const holdTime = 1200;

        const typeLoop = () => {
          const currentPhrase = typingPhrases[phraseIndex];
          if (!deleting) {
            typingEl.textContent = currentPhrase.substring(0, charIndex + 1);
            charIndex++;
            if (charIndex === currentPhrase.length) {
              setTimeout(() => {
                deleting = true;
                typeLoop();
              }, holdTime);
              return;
            }
          } else {
            typingEl.textContent = currentPhrase.substring(0, charIndex - 1);
            charIndex--;
            if (charIndex === 0) {
              deleting = false;
              phraseIndex = (phraseIndex + 1) % typingPhrases.length;
            }
          }
          setTimeout(typeLoop, deleting ? eraseSpeed : typeSpeed);
        };

          typeLoop();
        }
      }
    </script>
  </body>
</html>
