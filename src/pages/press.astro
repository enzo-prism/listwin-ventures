---
import { buttonVariants } from '@/components/ui/button';
import BaseLayout from '../layouts/BaseLayout.astro';
import PressLinkCard from '../components/PressLinkCard.astro';
import PressPhotoCard from '../components/PressPhotoCard.astro';
import { getPressItems, type PressItem } from '../data/press';

const pageTitle = 'Press & References | Don Listwin | Listwin Ventures';
const pageDescription =
  'Browse verified press coverage, interviews, and primary-source references about Don Listwin, Listwin Ventures, and Canary Foundation work.';

const pressItems = getPressItems();

const photoItemOrder = [
  'wikimedia-financial-times-portrait-2010',
  'stanford-medicine-profile-don-listwin',
  'stanford-medicine-deans-medal-2018-11-01',
  'stanford-canary-center-history',
  'stanford-radiology-directory',
  '4ag-board-appointment-2025-10-15',
];

const photoItems = photoItemOrder
  .map((id) => pressItems.find((item) => item.id === id))
  .filter((item): item is PressItem => Boolean(item && item.photo));

const photoItemIds = new Set(photoItems.map((item) => item.id));
const libraryItems = pressItems.filter((item) => !photoItemIds.has(item.id));
const featured = libraryItems.filter((item) => item.featured);
const rest = libraryItems.filter((item) => !item.featured);

const recognitionAcademic = rest.filter((item) => item.section === 'recognition-academic');
const globalHealthBelize = rest.filter((item) => item.section === 'global-health-belizekids');
const cancerEarlyDetection = rest.filter((item) => item.section === 'cancer-early-detection');
const boardsOperatorRoles = rest.filter((item) => item.section === 'boards-operator-roles');
const technologyLeadership = rest.filter((item) => item.section === 'technology-leadership');
const ungrouped = rest.filter((item) => !item.section);

const sections = [
  {
    id: 'recognition-academic',
    title: 'Recognition & Academic',
    description:
      'Stanford honors and official profiles that anchor academic affiliation, recognition, and early detection leadership.',
    items: recognitionAcademic,
  },
  {
    id: 'global-health-belizekids',
    title: 'Global Health & BelizeKIDS',
    description:
      'Stanford Ophthalmology annual reports documenting Belize vision clinic partnerships and global training initiatives.',
    items: globalHealthBelize,
  },
  {
    id: 'cancer-early-detection',
    title: 'Cancer Early Detection',
    description:
      'Canary Foundation work, institutional partnerships, and award coverage anchored by primary sources.',
    items: cancerEarlyDetection,
  },
  {
    id: 'boards-operator-roles',
    title: 'Boards & Operator Roles',
    description: 'Board appointments and operator leadership context from primary announcements.',
    items: boardsOperatorRoles,
  },
  {
    id: 'technology-leadership',
    title: 'Technology Leadership',
    description: 'Leadership transitions and operating context from industry press and primary announcements.',
    items: technologyLeadership,
  },
];

const visibleSections = sections.filter((section) => section.items.length > 0);
const browseAllAnchor = visibleSections[0] ? `#${visibleSections[0].id}` : ungrouped.length ? '#library' : '#featured';
---

<BaseLayout title={pageTitle} description={pageDescription}>
  <section class="lv-section">
    <div class="space-y-3 text-center">
      <p class="lv-eyebrow">Press</p>
      <h1 class="font-display text-4xl font-semibold text-foreground sm:text-5xl">Press & References</h1>
      <p class="mx-auto max-w-3xl text-base text-muted-foreground">
        A curated list of third-party coverage and primary references tied to Don’s operating history and current work.
      </p>

      <div class="flex flex-wrap justify-center gap-2 pt-2">
        {photoItems.length > 0 && <a class={buttonVariants({ variant: 'outline', size: 'sm' })} href="#photos">Photos & Portraits</a>}
        {featured.length > 0 && <a class={buttonVariants({ variant: 'outline', size: 'sm' })} href="#featured">Featured</a>}
        {visibleSections.map((section) => (
          <a key={section.id} class={buttonVariants({ variant: 'outline', size: 'sm' })} href={`#${section.id}`}>
            {section.title}
          </a>
        ))}
        {ungrouped.length > 0 && <a class={buttonVariants({ variant: 'outline', size: 'sm' })} href="#library">More</a>}
      </div>
    </div>

    <div class="grid gap-4 md:grid-cols-3">
      <article class="rounded-[1.5rem] border border-border/70 bg-muted/40 p-5">
        <p class="lv-eyebrow">What this is</p>
        <p class="mt-2 text-sm text-muted-foreground">Links for context, due diligence, and deeper reading.</p>
      </article>
      <article class="rounded-[1.5rem] border border-border/70 bg-muted/40 p-5">
        <p class="lv-eyebrow">How it’s used</p>
        <p class="mt-2 text-sm text-muted-foreground">
          We connect companies and initiatives back to original sources so the website stays grounded in verifiable history.
        </p>
      </article>
      <article class="rounded-[1.5rem] border border-border/70 bg-muted/40 p-5">
        <p class="lv-eyebrow">Want to add one?</p>
        <p class="mt-2 text-sm text-muted-foreground">If you have a missing citation or updated link, send it through contact.</p>
        <a class={`mt-4 w-full ${buttonVariants({ variant: 'default', size: 'sm' })}`} href="/contact">Share a link</a>
      </article>
    </div>
  </section>

  {photoItems.length > 0 && (
    <section id="photos" class="lv-section">
      <div class="space-y-2">
        <p class="lv-eyebrow">Photos & Portraits</p>
        <h2 class="lv-heading">Photos & Portraits</h2>
        <p class="text-sm text-muted-foreground">Licensed imagery plus external links to portraits hosted by their publishers.</p>
      </div>
      <div class="grid gap-5 md:grid-cols-2">
        {photoItems.map((item) => (
          <PressPhotoCard item={item} key={item.id} />
        ))}
      </div>
      <p class="text-xs text-muted-foreground">
        External portraits remain hosted by their publishers. We only re-host imagery with explicit reuse permission.
      </p>
    </section>
  )}

  {featured.length > 0 && (
    <section id="featured" class="lv-section bg-primary/[0.08] ring-primary/20">
      <div class="space-y-3">
        <div class="flex flex-wrap items-end justify-between gap-3">
          <div class="space-y-2">
            <p class="lv-eyebrow">Featured</p>
            <h2 class="lv-heading">Start here</h2>
          </div>
          <p class="text-xs font-semibold uppercase tracking-[0.3em] text-muted-foreground">
            {featured.length} featured • {pressItems.length} total links
          </p>
        </div>
        <p class="text-sm text-muted-foreground">
          Featured highlights only. Browse topic sections and the full library below for the complete set of links.
        </p>
        <a class={buttonVariants({ variant: 'outline', size: 'sm' })} href={browseAllAnchor}>Browse all links</a>
      </div>
      <div class="grid gap-6 md:grid-cols-2">
        {featured.map((item) => (
          <PressLinkCard item={item} variant="featured" showQuote={true} showTags={true} key={item.id} />
        ))}
      </div>
    </section>
  )}

  {visibleSections.map((section) => (
    <section key={section.id} id={section.id} class="lv-section">
      <div class="space-y-2">
        <p class="lv-eyebrow">Topic</p>
        <h2 class="lv-heading">{section.title}</h2>
        <p class="text-sm text-muted-foreground">{section.description}</p>
      </div>
      <div class="grid gap-5 md:grid-cols-2">
        {section.items.map((item) => (
          <PressLinkCard item={item} variant="standard" showTags={true} key={item.id} />
        ))}
      </div>
    </section>
  ))}

  {ungrouped.length > 0 && (
    <section id="library" class="lv-section">
      <div class="space-y-2">
        <p class="lv-eyebrow">More</p>
        <h2 class="lv-heading">Additional links</h2>
        <p class="text-sm text-muted-foreground">
          Other sources and internal releases that do not fit neatly into the topic sections above.
        </p>
      </div>
      <div class="grid gap-5 md:grid-cols-2">
        {ungrouped.map((item) => (
          <PressLinkCard item={item} variant="standard" showTags={true} key={item.id} />
        ))}
      </div>
      <p class="pt-2 text-xs text-muted-foreground">
        External content is owned by its publishers. This page links out for reference and context; it does not mirror full
        articles.
      </p>
    </section>
  )}
</BaseLayout>
