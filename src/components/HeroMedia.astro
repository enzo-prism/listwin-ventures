---
import type { VisualAsset } from '../data/assets';

export interface Props {
  asset: VisualAsset;
  rounded?: boolean;
  shadow?: boolean;
  className?: string;
  linkHref?: string | null;
  showCaption?: boolean;
}

const { asset, rounded = true, shadow = true, className = '', linkHref = undefined, showCaption = true } = Astro.props;

const resolvedLink = linkHref === null ? undefined : linkHref ?? asset.href;
const isExternal = resolvedLink ? !linkHref && !!asset.href : false;
const usesDarkFrame = asset.id === 'carbon-robotics';
const figureToneClass = usesDarkFrame ? 'bg-ink text-white/80 ring-white/20' : 'bg-white/90 text-ink/70 ring-white/60';
const captionToneClass = usesDarkFrame ? 'text-white/60' : 'text-ink/50';
const isLogoAsset = /\b(logo|lockup|crest)\b/i.test(asset.alt);
const showMediaCaption = showCaption && !isLogoAsset;
---

<figure
  class={`w-full flex flex-col items-center gap-3 rounded-apple p-4 text-center text-sm shadow-panel ring-1 ${figureToneClass} ${className}`}
>
  {resolvedLink ? (
    <a
      href={resolvedLink}
      target={isExternal ? '_blank' : undefined}
      rel={isExternal ? 'noopener noreferrer' : undefined}
      class={`${rounded ? 'overflow-hidden rounded-[28px]' : ''} block`}
    >
      <img
        src={asset.path}
        alt={asset.alt}
        loading="lazy"
        class={`w-full object-contain ${shadow ? 'shadow-panel' : ''}`}
      />
    </a>
  ) : (
    <img
      src={asset.path}
      alt={asset.alt}
      loading="lazy"
      class={`w-full object-contain ${rounded ? 'rounded-[28px]' : ''} ${shadow ? 'shadow-panel' : ''}`}
    />
  )}
  {showMediaCaption && (
    <figcaption class={`text-xs uppercase tracking-[0.25em] ${captionToneClass}`}>{asset.name}</figcaption>
  )}
</figure>
