---
import { buttonVariants } from '@/components/ui/button';
import { isExternalUrl, type PressItem } from '../data/press';

const { item } = Astro.props as { item: PressItem };
const photo = item.photo;

if (!photo) {
  throw new Error('PressPhotoCard requires a press item with photo metadata.');
}

const linkUrl = photo.kind === 'external' ? photo.url : photo.sourceUrl;
const linkLabel = photo.kind === 'external' ? photo.label : 'View source';
const external = isExternalUrl(linkUrl);
---

<article class="rounded-[1.8rem] border border-border/70 bg-card/95 p-5 shadow-sm transition hover:-translate-y-0.5 hover:shadow-panel">
  {photo.kind === 'hosted' && (
    <img
      src={photo.src}
      alt={photo.alt}
      width="1200"
      height="900"
      loading="lazy"
      class="aspect-[4/3] w-full rounded-[1.45rem] border border-border/70 object-cover"
    />
  )}
  <div class="mt-4 space-y-2">
    <p class="text-xs font-semibold uppercase tracking-[0.32em] text-muted-foreground">{item.publisher}</p>
    <h3 class="text-2xl font-semibold text-foreground">{item.title}</h3>
    <p class="text-sm text-muted-foreground">{item.summary}</p>
    {photo.kind === 'hosted' && (
      <p class="text-xs text-muted-foreground">
        {photo.credit} (
        <a class="underline" href={photo.licenseUrl} target="_blank" rel="noopener noreferrer">
          {photo.licenseLabel}
        </a>
        ) via{' '}
        <a class="underline" href={photo.sourceUrl} target="_blank" rel="noopener noreferrer">
          Wikimedia Commons
        </a>
      </p>
    )}
    {photo.kind === 'external' && <p class="text-xs text-muted-foreground">Photo is hosted by the original publisher.</p>}
    <a
      class={buttonVariants({ variant: 'outline', size: 'sm' })}
      href={linkUrl}
      target={external ? '_blank' : undefined}
      rel={external ? 'noopener noreferrer' : undefined}
    >
      {linkLabel}
    </a>
  </div>
</article>
