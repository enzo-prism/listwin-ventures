---
import { buttonVariants } from '@/components/ui/button';
import type { EntityDetail } from '../data/entityDetails';
import { getDetailPath } from '../data/entityDetails';

export interface Props {
  title?: string;
  items: EntityDetail[];
  hideImages?: boolean;
}

	const { title, items, hideImages = false } = Astro.props;

	const inferImageDimensionsFromPath = (
	  path: string,
	  fallback: { width: number; height: number },
	): { width: number; height: number } => {
	  const match = path.match(/-(\d+)x(\d+)\.(?:png|jpe?g|webp)(?:\?|$)/i);
	  if (match) {
	    return { width: Number(match[1]), height: Number(match[2]) };
	  }
	  return fallback;
	};
---

{items.length > 0 && (
  <section class="space-y-3">
	    {title && <h3 class="text-lg font-semibold text-foreground">{title}</h3>}
	    <div class="flex snap-x snap-mandatory gap-4 overflow-x-auto pb-2">
	      {items.map((item) => {
	        const dimensions = inferImageDimensionsFromPath(item.asset.path, { width: 320, height: 128 });
	        return (
	          <article
	            class="min-w-[260px] snap-start rounded-[1.5rem] border border-border/70 bg-card/95 p-4 text-left shadow-sm transition hover:-translate-y-0.5 hover:shadow-panel"
	            role="listitem"
	          >
	            {!hideImages && (
	              <img
	                src={item.asset.path}
	                alt={item.asset.alt}
	                width={dimensions.width}
	                height={dimensions.height}
	                loading="lazy"
	                class="mx-auto h-12 w-auto object-contain"
	              />
	            )}
	            <div class="mt-3 space-y-1">
	              <p class="text-sm font-semibold text-foreground">{item.name}</p>
	              <p class="text-xs text-muted-foreground">{item.summary}</p>
	            </div>
	            <a
	              class={`mt-3 ${buttonVariants({ variant: 'outline', size: 'sm' })}`}
	              href={getDetailPath(item.slug)}
	            >
	              View detail
	            </a>
	          </article>
	        );
	      })}
	    </div>
	  </section>
	)}
